<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Roue de sélection avec historique</title>
    <style>
        #history {
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <h1>Roue de sélection</h1>
    <div id="wheelContainer"></div>
    <button onclick="saveSelection()">Enregistrer la sélection</button>
    <div id="history"></div>

    <script>
    const participants = ["Antoine", "Isabelle", "Steve", "Kemodjan", "Manuel", "Veronique", "Marie", "Constant", "Beatrice", "Hanae", "Tristan"];
    let selectionHistory = [];

    function initWheel() {
        const choicesString = participants.join(',');
        const wheelUrl = `https://pickerwheel.com/emb/?choices=${choicesString}`;
        
        const iframe = document.createElement('iframe');
        iframe.src = wheelUrl;
        iframe.width = "500";
        iframe.height = "500";
        iframe.frameBorder = "0";
        iframe.id = "pickerWheel";

        const container = document.getElementById('wheelContainer');
        container.innerHTML = '';
        container.appendChild(iframe);
    }

    async function loadHistory() {
        try {
            const response = await fetch('selection_history.json');
            const data = await response.json();
            selectionHistory = data.history;
            updateHistoryDisplay();
        } catch (error) {
            console.error("Erreur lors du chargement de l'historique:", error);
        }
    }

    function saveSelection() {
        const wheelFrame = document.getElementById('pickerWheel');
        const selectedName = wheelFrame.contentWindow.document.querySelector('.wheel-item.selected .wheel-item-text').textContent;
        
        const now = new Date();
        const selection = {
            name: selectedName,
            date: now.toISOString()
        };
        
        selectionHistory.push(selection);
        updateHistoryDisplay();
        updateJSON();
    }

    function updateHistoryDisplay() {
        const historyDiv = document.getElementById('history');
        historyDiv.innerHTML = '<h2>Historique des sélections</h2>';
        const ul = document.createElement('ul');
        selectionHistory.forEach(selection => {
            const li = document.createElement('li');
            li.textContent = `${selection.name} - ${new Date(selection.date).toLocaleString()}`;
            ul.appendChild(li);
        });
        historyDiv.appendChild(ul);
    }

    async function updateJSON() {
        try {
            const response = await fetch('update-history-endpoint', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ history: selectionHistory }),
            });
            // Gérer la réponse si nécessaire
        } catch (error) {
            console.error("Erreur lors de la mise à jour de l'historique:", error);
        }
    }

    initWheel();
    loadHistory();
    </script>
</body>
</html>
